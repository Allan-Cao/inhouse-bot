import discord
import os
import datetime

### SQL Queries ###
user_insert_query = """
INSERT INTO users
(ign, id, main_role, secondary_role, fill_queue, elo, timeout)
VALUES ( %s, %s, %s, %s, %s, %s, %s )
"""
ign_lookup_query = "SELECT * FROM users WHERE ign = %s"
discord_id_lookup_query = "SELECT * FROM users WHERE id = %s"
update_discord_id_query = "UPDATE users SET id = %s WHERE ign = %s"

### Setup SQL
import mysql.connector
from mysql.connector import Error

try:
    connection = mysql.connector.connect(host=os.getenv('SQL_URL'),
                                         database='inhouse', #CREATE DATABASE inhouse
                                         user=os.getenv('SQL_USER'),
                                         password=os.getenv('SQL_PWD'))
    if connection.is_connected():
        db_Info = connection.get_server_info()
        print("Connected to MySQL Server version ", db_Info)
        cursor = connection.cursor()
except Error as e:
    print("Error while connecting to MySQL", e)

def lookup_by_discord_id(id):
    with connection.cursor() as cursor:
        cursor.execute(discord_id_lookup_query, (id,))
        myresult = cursor.fetchone()
    if myresult == None:
        return None
    else:
        return(myresult)
def generate_queue():
    embed = discord.Embed(
        title="Queue Test",
        description="test123",
        color=discord.Colour.blurple(), # Pycord provides a class with default colors you can choose from
    )
    embed.add_field(name="A Normal Field", value="A really nice field with some information. **The description as well as the fields support markdown!**")

    embed.add_field(name="Top: Player1", value="Top: Player2", inline=True)
    embed.add_field(name="Jungle: Player3", value="Jungle: Player4", inline=True)
    embed.add_field(name="Mid: Player5", value="Mid: Player6", inline=True)
    embed.add_field(name="ADC: Player7", value="ADC: Player8", inline=True)
    embed.add_field(name="Support: Player9", value="Support: Player10", inline=True)

    embed.set_footer(text="Queue generated by Seraphine Bot") # footers can have icons too
    #embed.set_author(name="Pycord Team", icon_url="https://example.com/link-to-my-image.png")
    #embed.set_thumbnail(url="https://example.com/link-to-my-thumbnail.png")
    #embed.set_image(url="https://example.com/link-to-my-banner.png")
    return embed

def add_user(user):
    with connection.cursor() as cursor:
        cursor.executemany(user_insert_query, user)
        connection.commit()
def lookup_by_ign(ign):
    with connection.cursor() as cursor:
        cursor.execute(ign_lookup_query, (ign,))
        myresult = cursor.fetchone()
    if myresult == None:
        return None
    else:
        return(myresult)
def update_discord_id(id, ign):
    with connection.cursor() as cursor:
        cursor.execute(update_discord_id_query, (id, ign,))
        connection.commit()
def format_playercard_embed(player_information):
    x = datetime.datetime.now()
    formatted_time = x.strftime("%H:%M EST, %b %d %Y")
    name, discord_id, primary_role, second_role, fill, elo, timeout = player_information

    embed = discord.Embed(
        title=f"{name} Player Data",
        color=discord.Colour.nitro_pink(), # Pycord provides a class with default colors you can choose from
    )
    embed.add_field(name="ELO", value=elo, inline=True)
    embed.add_field(name="Primary Role", value=primary_role, inline=True)
    embed.add_field(name="Secondary Role", value=second_role, inline=True)
    if fill == 0:
        can_fill = "No."
    else:
        can_fill = "Yes!"
    embed.add_field(name="Able to queue fill?", value=can_fill, inline=True)
    if discord_id == 0:
        linked_account = "Not linked"
    else:
        linked_account = f"<@!{discord_id}>"
    embed.add_field(name="Linked discord account", value=linked_account)
    embed.set_footer(text=f"Informated generated by Seraphine Bot at {formatted_time}")
    return embed
def stop_sql():
    with connection.cursor() as cursor:
        cursor.close()
        connection.close()